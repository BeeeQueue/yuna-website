{"version":3,"sources":["js/index.ts"],"names":["trackDownload","fathom","initialLogoHeight","initLogo","logo","document","querySelector","clientHeight","body","onscroll","size","scroll","documentElement","scrollTop","newSize","Math","max","min","setAttribute","classList","add","remove","updateReleaseButton","latestRelease","platform","ext","navigator","match","downloadButton","getElementById","lastChild","innerHTML","tag_name","correctAsset","assets","find","release","name","endsWith","onclick","url","browser_download_url","location","href","addEventListener","lazyImages","querySelectorAll","window","observer_1","IntersectionObserver","entries","forEach","entry","isIntersecting","image","target","src","dataset","srcset","onload","unobserve","observe","loadLazyImages","link","hash","URL","e","preventDefault","destination","slice","scrollTo","top","offsetTop","behavior","currentTarget","paused","__awaiter","cachedRelease","localStorage","getItem","updatedAt","Number","JSON","parse","isStale","Date","now","fetch","_a","sent","json","setItem","stringify","keys","obj","willReturn","counter","length","pick","toString"],"mappings":"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","file":"index.js","sourcesContent":["const pick = <K extends Array<keyof T>, T extends {}>(keys: K, obj: T) => {\n  const willReturn = {} as any\n  let counter = 0\n\n  while (counter < keys.length) {\n    if (keys[counter] in obj) {\n      willReturn[keys[counter]] = obj[keys[counter]]\n    }\n    counter++\n  }\n\n  return willReturn as Pick<T, K[number]>\n}\n\nconst trackDownload = () => {\n  fathom('trackGoal', '0OQBGIRR', 0)\n}\n\nconst loadLazyImages = () => {\n  const lazyImages = document.querySelectorAll('img.lazy')\n\n  if ('IntersectionObserver' in window) {\n    const observer = new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (!entry.isIntersecting) return\n\n        const image = entry.target as HTMLImageElement\n        image.src = image.dataset.src as string\n        image.srcset = image.dataset.srcset || ''\n\n        image.onload = () => {\n          image.classList.remove('lazy')\n          image.onload = null\n        }\n        observer.unobserve(image)\n      })\n    })\n\n    lazyImages.forEach(image => observer.observe(image))\n  }\n}\n\nlet initialLogoHeight = 0\nconst initLogo = () => {\n  const logo = document.querySelector('.logo') as HTMLImageElement\n  initialLogoHeight = logo.clientHeight\n\n  const setSize = (size: number) => {\n    logo.setAttribute('style', `height: ${size}px; width: ${size}px`)\n  }\n\n  document.body.onscroll = () => {\n    const scroll = document.documentElement.scrollTop\n\n    const newSize = Math.max(\n      50,\n      Math.min(initialLogoHeight, initialLogoHeight - scroll),\n    )\n\n    setSize(newSize)\n\n    if (scroll >= 50) return logo.classList.add('small')\n    if (scroll < 50) return logo.classList.remove('small')\n  }\n}\n\nconst initHeaderLinks = () => {\n  const links = document.querySelectorAll<HTMLLinkElement>('header > a')\n\n  links.forEach(link => {\n    const { hash } = new URL(link.href)\n    if (hash === '') return\n\n    link.onclick = e => {\n      e.preventDefault()\n\n      // Slice to remove the #\n      const destination = document.getElementById(hash.slice(1))\n\n      if (!destination) return\n\n      document.documentElement.scrollTo({\n        top: destination.offsetTop - 50,\n        behavior: 'smooth',\n      })\n    }\n  })\n}\n\nconst initPlayer = () => {\n  const player = document.querySelector('video') as HTMLVideoElement\n\n  player.onclick = e => {\n    const target = e.currentTarget as HTMLVideoElement\n\n    target[target.paused ? 'play' : 'pause']()\n  }\n}\n\nconst getExtension = () => {\n  const { platform } = navigator\n\n  if (platform.match(/[wW]in/)) return '.exe'\n  if (platform.match(/[mM]ac/)) return '.dmg'\n}\n\ntype ThinRelease = Pick<GitHubRelease, 'assets' | 'name' | 'tag_name'>\nconst MINUTE = 1000 * 60\nconst getRelease = async () => {\n  let latestRelease: GitHubRelease | ThinRelease | null = null\n  const cachedRelease = localStorage.getItem('release')\n  const updatedAt = Number(localStorage.getItem('updatedAt') || 0)\n\n  if (cachedRelease) {\n    latestRelease = JSON.parse(cachedRelease) as ThinRelease\n\n    updateReleaseButton(latestRelease)\n  }\n\n  const isStale = updatedAt + MINUTE < Date.now()\n  if (!cachedRelease || isStale) {\n    const response = await fetch(\n      'https://api.github.com/repos/BeeeQueue/yuna/releases?page=1',\n    )\n    latestRelease = (await response.json())[0] as GitHubRelease\n\n    updateReleaseButton(latestRelease)\n\n    localStorage.setItem(\n      'release',\n      JSON.stringify(pick(['assets', 'name', 'tag_name'], latestRelease)),\n    )\n    localStorage.setItem('updatedAt', Date.now().toString())\n  }\n}\n\nconst updateReleaseButton = (latestRelease: ThinRelease) => {\n  const ext = getExtension()\n  const downloadButton = document.getElementById(\n    'download',\n  ) as HTMLButtonElement\n  ;(downloadButton.lastChild as HTMLParagraphElement).innerHTML =\n    latestRelease.tag_name\n\n  const correctAsset = latestRelease.assets.find(release =>\n    release.name.endsWith(ext || 'shabalabadoo'),\n  )\n\n  downloadButton.onclick = trackDownload\n\n  if (!correctAsset) return\n\n  const url = correctAsset.browser_download_url\n\n  downloadButton.onclick = () => {\n    trackDownload()\n    location.href = url\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  loadLazyImages()\n  initLogo()\n  initHeaderLinks()\n  initPlayer()\n\n  getRelease()\n})\n"]}